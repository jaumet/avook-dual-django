<!DOCTYPE html>
<html>
<head>
  <title>Dual – Player</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Dual — comprensió i escolta">
  <meta property="og:description" content="Aprèn llengües escoltant històries. Dual combina dues llengües en una experiència auditiva única: comprensió i escolta.">
  <meta property="og:image" content="https://dual.cat/dual/imgs/logo-dual-fons-blau.png">
  <meta property="og:url" content="https://dual.cat/dual/">
  <meta name="twitter:card" content="https://dual.cat/dual/imgs/logo.png">
  <meta name="twitter:title" content="Dual — comprensió i escolta">
  <meta name="twitter:description" content="Aprèn llengües escoltant històries. Dual combina dues llengües en una experiència auditiva única: comprensió i escolta.">
  <meta name="twitter:image" content="https://dual.cat/dual/imgs/logo-dual-fons-blau.png">
  <link rel="stylesheet" href="./css/player.css"/>
  <link rel="stylesheet" href="./css/index.css"/>
</head>
<body>
<header>
  <a href="https://dual.cat/dual/">
    <img src="./imgs/logo-dual-fons-blau.png" alt="Dual logo"/> <h2>Dual</h2>
  </a>
  <div id="help" class="help">
    <h3>ℹ️ Com aprofitar al màxim Dual</h3>
    <p><strong>Dual</strong> és una manera divertida i efectiva d’aprendre llengües escoltant històries en dues versions:
    <ul>
      <li><strong>Comprensió:</strong> una versió més lenta i senzilla, pensada per entendre la història.</li>
      <li><strong>Escolta:</strong> la versió original, per gaudir-la a velocitat normal.</li>
    </ul>
    Amb Dual, pots aprendre escoltant històries, sense pressió i amb plaer.</p>
  </div>
</header>
<main>
  <div class="player">
    <div class="player__header">
      <button id="backBtn" class="player__back">
        <img src="./imgs/back.svg" alt="Back"/>
      </button>
      <h2 id="title" class="player__title"></h2>
    </div>
    <div id="items" class="player__items"></div>
  </div>
</main>
<script>
  const qs=q=>document.querySelector(q);
  const qsa=q=>document.querySelectorAll(q);
  async function getJSON(url){
    const res=await fetch(url);
    if(!res.ok) throw new Error(`Could not fetch ${url}. ${res.status}`);
    return res.json();
  }

  function renderItems(items, titleName) {
    const container = qs('#items');
    container.innerHTML = '';
    items.forEach(item => {
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `
        <div class="item__title">${item.title}</div>
        <div class="item__buttons">
          <button class="item__button" data-src="${item.file}">${item.button_text}</button>
        </div>
      `;
      container.appendChild(div);
    });
    qsa('.item__button').forEach(btn=>{
      btn.onclick=()=>{
        const src=`https://dual.cat/dual/AUDIOS/${titleName}/${item.file.replace(/^\.?\/*/,'')}`;
        console.log(`Playing ${src}`);
      }
    })
  }

  async function init(){
    const urlParams = new URLSearchParams(window.location.search);
    const titleName = urlParams.get('title');
    if(!titleName) return;

    const data = await getJSON(`./audios/${titleName}.json`);
    const humanTitle=data.human_title || titleName;
    qs('#title').textContent = humanTitle;
    document.title="Dual – "+humanTitle;

    renderItems(data.items, titleName);
    qs('#backBtn').onclick=()=>{window.location.href='https://dual.cat/dual/';};
  }
  init();
</script>
</body>
</html>
