{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/catalog_filters.css' %}">
{% endblock %}

{% block content %}
<main>
  <h3 data-translate-key="catalog.what_is_dual">‚ÑπÔ∏è Qu√® √©s Audiovook Dual?</h3>
  <p data-translate-key="catalog.what_is_dual_text">
    Audiovook Dual √©s una col¬∑lecci√≥ d‚Äôaudiorelats biling√ºes que et permet escoltar una mateixa hist√≤ria en dues lleng√ºes. √âs una forma d‚Äôaprendre jugant amb el so, la repetici√≥ i el context.
  </p>
  <h2 style="text-align:center" data-translate-key="catalog.available_stories">üìö Relats disponibles</h2>

  <!-- Level buttons -->
  <h3 style="text-align:center">Selecciona nivell:</h3>
  <section id="levelSection">
    {% for level in levels %}
      <button class="levelBtn">{{ level }}</button>
    {% endfor %}
  </section>

  <!-- Toggle filters button -->
  <div id="advancedSearchToggle">
    <button id="toggleFiltersBtn">üîç Cerca avan√ßada</button>
  </div>

  <!-- Filters bar (hidden by default) -->
  <section id="filtersBar" style="display:none;">
    <div class="av-input">
      <input type="text" id="searchInput" placeholder="üîç Cerca per text o t√≠tol..." />
    </div>
    <div class="av-select" data-placeholder="Col¬∑lecci√≥">
      <label>Col¬∑lecci√≥</label>
      <select id="filterColection">
        <option value="">‚Äî</option>
        {% for collection in collections %}<option value="{{ collection }}">{{ collection }}</option>{% endfor %}
      </select>
    </div>
    <div class="av-select" data-placeholder="Durada">
      <label>Durada</label>
      <select id="filterDuration">
        <option value="">‚Äî</option>
        {% for duration in durations %}<option value="{{ duration }}">{{ duration }}</option>{% endfor %}
      </select>
    </div>
    <div class="av-select" data-placeholder="Lleng√ºes">
      <label>Lleng√ºes</label>
      <select id="filterLang">
        <option value="">‚Äî</option>
        {% for language in languages %}<option value="{{ language }}">{{ language }}</option>{% endfor %}
      </select>
    </div>
    <div class="av-select" data-placeholder="Edats">
      <label>Edats</label>
      <select id="filterAges">
        <option value="">‚Äî</option>
        {% for age in ages_list %}<option value="{{ age }}">{{ age }}</option>{% endfor %}
      </select>
    </div>
  </section>

  <section id="catalog">
    {% for item in titles_with_status %}
      <div class="titleCard">
        <img src="{{ item.image_url }}" alt="{{ item.title.human_name }}">
        <div class="meta-top">
          {% if item.title.levels %}<span class="level">{{ item.title.levels }}</span>{% endif %}
          {% if item.title.ages %}<span class="ages">{{ item.title.ages }}</span>{% endif %}
        </div>
        <div class="cardText">
          <h3>{{ item.title.human_name }}</h3>
          <div class="meta">
            {% if item.title.collection %}<span class="colection">{{ item.title.collection }}</span>{% endif %}
            {% if item.title.duration %}<span class="duration">{{ item.title.duration }}</span>{% endif %}
          </div>
          {% if item.title.languages.all %}
            <div class="langList">
              {{ item.title.languages.all|join:", " }}
            </div>
          {% endif %}
          {% if item.title.description %}<div class="description">{{ item.title.description }}</div>{% endif %}
        </div>
        <div class="cardAction">
          {% if item.status == 'FREE' or item.status == 'PREMIUM_OWNED' %}
            <a href="{% url 'products:player' item.title.machine_name %}" class="av-btn av-btn-primary">Play</a>
          {% else %}
            <a href="{% url 'products:product_list' %}" class="av-btn">Compra'l</a>
          {% endif %}
        </div>
      </div>
    {% empty %}
      <p>No hi ha t√≠tols publicats actualment.</p>
    {% endfor %}
  </section>
</main>
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <script src="{% static 'js/catalog_filters.js' %}"></script>
{% endblock %}
