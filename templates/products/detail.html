{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ product.name }} — Audiovook Dual{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/product_detail.css' %}">
{% endblock %}

{% block content %}
<section class="product-detail">
    <div class="product-detail__header">
        <div class="product-detail__media">
            <img src="{% static 'imgs/mockup_portada.png' %}" alt="{{ product.name }}" />
        </div>
        <div>
            <h1>{{ product.name }}</h1>
            <p class="lead">{{ product.description }}</p>
            <div class="product-detail__meta">
                <p class="price">{% trans "Preu:" %} {{ product.price }} €</p>
                <p>{% trans "Durada:" %} {{ product.duration }} {% trans "mesos" %}</p>
            </div>
             {% if user.is_authenticated and user.is_staff %}
                <a class="button button--small" href="{% url 'products:product_update' product.pk %}">{% trans "Editar producte" %}</a>
            {% endif %}
        </div>
    </div>

    <div class="product-detail__legal">
        <h2>{% trans "Condicions de venda" %}</h2>
        <div class="scrollable-div">
            <h3>{% trans "1. Objecte" %}</h3>
            <p>{% trans "Les presents Condicions Generals de Venda tenen per objecte regular la relació contractual de compravenda nascuda entre el Venedor i el Client en el moment en què aquest accepta durant el procés de contractació en línia la casella corresponent." %}</p>

            <h3>{% trans "2. Durada" %}</h3>
            <p>{% trans "La relació contractual s'entendrà formalitzada des del moment de la compra i tindrà la durada corresponent al període de subscripció seleccionat pel Client." %}</p>

            <h3>{% trans "3. Preu i forma de pagament" %}</h3>
            <p>{% trans "El preu del servei serà el que s'indiqui en la nostra pàgina web en el moment de la compra. El pagament es realitzarà mitjançant targeta de crèdit o dèbit a través de la passarel·la de pagament segura." %}</p>

            <h3>{% trans "4. Obligacions del Client" %}</h3>
            <p>{% trans "El Client es compromet a utilitzar el servei de forma diligent i correcta, així com a facilitar dades veraces en el procés de registre i compra." %}</p>
        </div>
    </div>

    <div class="product-detail__purchase">
        <div class="form-check">
            <input type="checkbox" id="accept-conditions" class="form--input">
            <label for="accept-conditions" class="form-check-label">{% trans "Accepto les condicions de venda" %}</label>
        </div>
        <button id="buy-button" class="button button--primary">{% trans "Comprar ara" %}</button>
    </div>

    {% for package in product.packages.all %}
    <div class="product-detail__titles">
        <h2>{% trans "Títols inclosos en el paquet:" %} {{ package.name }}</h2>
        {% if package.titles.all %}
            <ul>
                {% for title in package.titles.all %}
                    <li class="product-detail__title-item">
                        <div>
                            <p class="kicker">{% trans "Nivell" %} {{ title.levels }}</p>
                            <strong>{{ title.human_name }}</strong>
                            {% if title.description %}
                                <p>{{ title.description }}</p>
                            {% endif %}
                            <p class="product-card__meta">{% trans "Idiomes:" %}
                                {% for lang in title.languages.all %}
                                    {{ lang.language }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </p>
                            {% if title.duration %}<p class="product-card__meta">{% trans "Durada:" %} {{ title.duration }}</p>{% endif %}
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>{% trans "Encara no hi ha títols assignats a aquest paquet." %}</p>
        {% endif %}
    </div>
    {% endfor %}
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const acceptConditions = document.getElementById('accept-conditions');
    const buyButton = document.getElementById('buy-button');

    acceptConditions.addEventListener('change', function() {
        if (this.checked) {
            buyButton.style.display = 'block';
        } else {
            buyButton.style.display = 'none';
        }
    });
});
</script>
{% endblock %}
