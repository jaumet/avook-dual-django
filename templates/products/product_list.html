{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/custom_title_card.css' %}">
    <link rel="stylesheet" href="{% static 'css/dual-products.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1>{% trans "Productes" %}</h1>
    <hr>

    <div class="dual-payments">
      {% for product in products %}
        <div class="dual-product">
          {% if product.machine_name == 'dual-start' %}
            <div class="ribbon ribbon-start">{{ product.translation.name }}</div>
          {% elif product.machine_name == 'dual-progress' %}
            <div class="ribbon ribbon-progress">{{ product.translation.name }}</div>
          {% elif product.machine_name == 'dual-advanced' %}
            <div class="ribbon ribbon-advanced">{{ product.translation.name }}</div>
          {% elif product.machine_name == 'dual-full' %}
            <div class="ribbon ribbon-full">{{ product.translation.name }}</div>
          {% endif %}
          <h3>{{ product.translation.name }}</h3>
          <p>{{ product.translation.description|safe }}</p>
          {% if user.is_authenticated %}
            <div id="paypal-{{ product.machine_name }}"></div>
          {% else %}
            <div class="my-3">
              <a href="{% url 'accounts:login' %}" class="btn btn-primary">{% trans "Login / Register" %}</a>
              <p class="mt-2"><small>{% trans "To buy products, you need to log in or register to Dual.cat" %}</small></p>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <!-- Notes generals -->
    <div class="dual-notes">
      <p>
        <strong>{% trans "Notes importants:" %}</strong><br>
        • {% trans "Tots els packs són" %} <strong>{% trans "bidireccionals" %}</strong> (L1↔L2).<br>
        • {% trans "Inclouen" %} <strong>{% trans "totes les llengües disponibles" %}</strong>.<br>
        • {% trans "L’accés és" %} <strong>{% trans "temporal" %}</strong> {% trans "i" %} <strong>{% trans "no es renova automàticamente" %}</strong>.<br>
        • {% trans "Un cop finalitzat el període, cal adquirir un nou pack per continuar." %}
      </p>
    </div>

    <div class="mt-5 text-center">
        <a href="{% url 'products:catalog' %}" class="btn btn-primary">{% trans "Navega pel catàleg" %}</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script src="https://www.paypal.com/sdk/js?client-id={{ PAYPAL_CLIENT_ID_LIVE }}&currency=EUR"></script>
<script src="{% static 'js/paypal_buttons.js' %}"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const successUrl = "{% url 'products:success' %}";
    {% if user.is_authenticated %}
    {% for product in products %}
    renderButton(
        "#paypal-{{ product.machine_name }}",
        "{{ product.translation.name }}",
        "{{ product.price }}",
        "{{ product.machine_name }}",
        successUrl
    );
    {% endfor %}
    {% endif %}
});
</script>
{% endblock %}
